<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сопова Вика. Лабораторная 7</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon-32x32.png">
    <link rel="icon" href="favicon-16x16.ico">
    <link rel="stylesheet" href="../main.css">
    <style>
        .chart-container {
            margin: 20px;
            padding: 20px;
            border: 1px solid #ccc;
        }
        #weatherChart {
            width: 800px;
            height: 400px;
        }
        .current-data {
            margin: 20px;
            padding: 10px;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <header>
        <h1>Прогноз погоды и текущие условия</h1>
    </header>
    <main>
        <div class="current-data">
            <h3>Текущие показатели:</h3>
            <p id="currentTemp"></p>
            <p id="currentHumidity"></p>
        </div>
        <div class="chart-container">
            <canvas id="weatherChart"></canvas>
        </div>
    </main>
    <footer>
        <p>Данные предоставлены <a href="https://open-meteo.com/">Open-Meteo</a></p>
    </footer>

    <script>
        
        const latitude = 55.0415;
        const longitude = 82.9346;

        function formatTime(isoTime) {
            const date = new Date(isoTime);
            return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        }

        async function fetchWeatherData() {
            try {
                const response = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&hourly=temperature_2m,relative_humidity_2m&current_weather=true&timezone=Asia%2FBangkok`
                );
                
                const data = await response.json();
                const forecastTemp = data.hourly.temperature_2m.slice(0, 24);
                const currentTemp = data.current_weather.temperature;
                const currentHumidity = data.hourly.relative_humidity_2m[0];

                document.getElementById('currentTemp').textContent = 
                    `Текущая температура: ${currentTemp} °C`;
                document.getElementById('currentHumidity').textContent = 
                    `Влажность: ${currentHumidity}%`;

                const ctx = document.getElementById('weatherChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: forecastHours.map(formatTime),
                        datasets: [{
                            label: 'Прогноз температуры (°C)',
                            data: forecastTemp,
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Температура (°C)'
                                }
                            }
                        }
                    }
                });

            } catch (error) {
                console.error('Ошибка получения данных:', error);
            }
        }

        fetchWeatherData();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>